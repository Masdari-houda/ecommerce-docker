<div class="container-fluid py-5 mt-5">

  <div class="step-indicator mx-auto" style="max-width: 800px;">
    <div class="step">1</div>
    <div class="step-line"></div>
    <div class="step active">2</div>
  </div>

  <div class="row g-4 mx-auto" style="max-width: 1200px;">

    <!-- Left Column: Delivery Details -->
    <div class="col-lg-7">
      <button class="btn btn-secondary mb-4" (click)="retourPanier()">
        <i class="bi bi-arrow-left me-2"></i> Retour au panier
      </button>

      <div class="card border-0 shadow-sm">
        <div class="card-header bg-white border-bottom-0 pt-4 px-4">
          <h5 class="mb-0 fs-4"><i class="bi bi-geo-alt-fill me-2"></i> Adresse de livraison</h5>
        </div>
        <div class="card-body p-4">
          <form #addressForm="ngForm">
            <div class="row g-3">
              <div class="col-md-6">
                <label class="form-label">Nom</label>
                <input type="text" class="form-control" [(ngModel)]="adresseLivraison.nom" name="nom" required
                  placeholder="Votre nom">
              </div>
              <div class="col-md-6">
                <label class="form-label">Prénom</label>
                <input type="text" class="form-control" [(ngModel)]="adresseLivraison.prenom" name="prenom" required
                  placeholder="Votre prénom">
              </div>

              <div class="col-12">
                <label class="form-label">Adresse</label>
                <input type="text" class="form-control" [(ngModel)]="adresseLivraison.adresse" name="adresse" required
                  placeholder="Numéro et nom de rue">
              </div>

              <div class="col-md-6">
                <label class="form-label">Ville</label>
                <input type="text" class="form-control" [(ngModel)]="adresseLivraison.ville" name="ville" required
                  placeholder="Ville">
              </div>
              <div class="col-md-6">
                <label class="form-label">Code postal</label>
                <input type="text" class="form-control" [(ngModel)]="adresseLivraison.codePostal" name="codePostal"
                  required placeholder="Code postal">
              </div>

              <div class="col-12">
                <label class="form-label">Téléphone</label>
                <input type="tel" class="form-control" [(ngModel)]="adresseLivraison.telephone" name="telephone"
                  required placeholder="Votre numéro de téléphone">
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Right Column: Order Summary -->
    <div class="col-lg-5">
      <div class="card border-0 shadow-sm sticky-top" style="top: 100px; z-index: 10;">
        <div class="card-header bg-white border-bottom-0 pt-4 px-4">
          <h5 class="mb-0 fs-4"><i class="bi bi-bag-check-fill me-2"></i> Récapitulatif</h5>
        </div>
        <div class="card-body p-4">
          <div class="table-responsive mb-4" style="max-height: 300px; overflow-y: auto;">
            <table class="table table-borderless align-middle">
              <tbody>
                <tr *ngFor="let p of produits">
                  <td style="width: 60px;">
                    <div
                      style="width: 50px; height: 50px; background: #f8fafc; border-radius: 8px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
                      <img [src]="p.produit.thumbnail || 'https://via.placeholder.com/50'" alt=""
                        style="max-width: 100%; max-height: 100%;">
                    </div>
                  </td>
                  <td>
                    <div class="fw-bold text-dark small">{{ p.produit.name || p.produit.title }}</div>
                    <div class="text-muted small">Qté: {{ p.quantity }}</div>
                  </td>
                  <td class="text-end fw-bold text-dark">{{ getTotalProduit(p) | number:'1.2-2' }} dh</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="total-box">
            <span class="total-label">Total à payer</span>
            <span class="total-amount">{{ total | number:'1.2-2' }} dh</span>
          </div>

          <button class="btn btn-success w-100 mt-4 py-3 shadow-lg" (click)="validerCommande()"
            [disabled]="!addressForm.valid && false">
            Confirmer la commande <i class="bi bi-arrow-right ms-2"></i>
          </button>

          <div class="text-center mt-3 small text-muted">
            <i class="bi bi-shield-lock-fill me-1"></i> Paiement sécurisé à la livraison
          </div>
        </div>
      </div>
    </div>

  </div>
</div>