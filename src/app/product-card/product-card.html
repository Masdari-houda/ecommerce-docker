<div class="card h-100 border-0 shadow-sm" (click)="onSelect()" role="button" tabindex="0"
     (keydown.enter)="onSelect()" (keydown.space)="onSelect()">
  <button type="button" class="quick-view" (click)="onQuickView($event)" title="Aperçu" aria-label="Aperçu">
    <i class="bi bi-eye"></i>
  </button>

  <span *ngIf="product.oldPrice && product.oldPrice > product.price" class="badge-discount">
    -{{ ((product.oldPrice - product.price) / product.oldPrice * 100) | number:'1.0-0' }}%
  </span>

  <img [src]="product.img || product.thumbnail || 'https://via.placeholder.com/300x300?text=Image'"
       class="card-img-top p-3"
       alt="{{ product.name || product.title }}"
       style="height:220px; object-fit:contain; background:white">

  <div class="card-body d-flex flex-column p-3">
    <h6 class="card-title small lh-base mb-1">
      {{ product.name || product.title }}
    </h6>

    <p *ngIf="product.description" class="small text-muted mb-2 text-truncate">
      {{ product.description }}
    </p>

    <p *ngIf="product.stock !== undefined" class="small mb-2">
      <span *ngIf="product.stock! > 0; else outStock" class="text-success">En stock</span>
      <ng-template #outStock>
        <span class="text-danger">Rupture de stock</span>
      </ng-template>
    </p>

    <div class="mt-auto">
      <div class="d-flex align-items-end gap-2 mb-3">
        <span *ngIf="product.oldPrice" class="text-muted text-decoration-line-through">
          {{ product.oldPrice * 10 | number:'1.2-2'}} dh
        </span>
        <span class="h4 fw-bold text-danger mb-0">
          {{ product.price * 10 | number:'1.2-2'}} dh
        </span>
      </div>

      <button class="btn btn-warning w-100 rounded-0 fw-bold text-dark"
              [disabled]="(product.stock ?? 0) <= 0"
              (click)="onAddToCart($event)">
        Ajouter au panier
      </button>
    </div>
  </div>
</div>
